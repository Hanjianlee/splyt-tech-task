(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(24),i=n.n(c),o=(n(56),n(6)),s=n(11),u=n.n(s),l=n(26),d=n(27),E=(n(61),n(8)),O=(n(62),n(30)),j="multipart/form-data",b="Nearest-HQ",_=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_KEY:"SPLYT_DRIVERS",REACT_APP_API_URL:"http://localhost:8000",REACT_APP_MAP_GL_STYLE:"mapbox://styles/hanjianlee/cksaik6c72bn617pjm3hbo37w",REACT_APP_MAP_GL_TOKEN:"pk.eyJ1IjoiaGFuamlhbmxlZSIsImEiOiJja3M3a2pzajEzaWd5MnBvNzRsZmxkY2tjIn0.tjizL4MBEZPSWqp6FQ-AGA"}),v=_.REACT_APP_API_URL,T=(_.REACT_APP_API_KEY,_.REACT_APP_MAP_GL_STYLE),p=_.REACT_APP_MAP_GL_TOKEN,h=[{country:"Singapore",longitude:103.8522982,latitude:1.285194},{country:"London",longitude:-.0964509,latitude:51.5049375}],g=(n(63),n(4)),A=function(e){var t,n,a,c=Object(r.useState)({width:"100vw",height:"100vh",latitude:51.5049375,longitude:-.0964509,zoom:14}),i=Object(E.a)(c,2),s=i[0],u=i[1];return Object(r.useEffect)((function(){var t,n,r=(null===(t=e.user)||void 0===t?void 0:t.HQLocation)?null===(n=e.user)||void 0===n?void 0:n.HQLocation:s,a=r.latitude,c=r.longitude;(s.latitude!==a||s.longitude!==c)&&c&&a&&u(Object(o.a)(Object(o.a)({},s),{},{longitude:c,latitude:a}))}),[null===(t=e.user)||void 0===t?void 0:t.HQLocation.longitude,null===(n=e.user)||void 0===n?void 0:n.HQLocation.latitude]),Object(r.useEffect)((function(){function e(e){var t=e.target;u(Object(o.a)(Object(o.a)({},s),{},{width:t.innerWidth,height:t.innerHeight}))}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[s]),Object(g.jsxs)(O.b,Object(o.a)(Object(o.a)({mapStyle:T},s),{},{mapboxApiAccessToken:p,onViewportChange:function(e){return u(e)},maxZoom:20,minZoom:10,ref:function(e){return window.map=e},children:[h.map((function(e){return Object(g.jsx)(O.a,{longitude:e.longitude,latitude:e.latitude,children:Object(g.jsx)("img",{className:"splyt-marker-svg",src:"/splytMarker.svg",alt:"/splytMarker.svg"})},e.country)})),null===(a=e.driver)||void 0===a?void 0:a.drivers.map((function(e){return Object(g.jsx)(O.a,{longitude:e.location.longitude,latitude:e.location.latitude,children:Object(g.jsx)("img",{className:"taxi-marker-svg",src:"/image2vector.svg",alt:"/image2vector.svg",style:{transform:"rotate(".concat(e.location.bearing-90,"deg)")}})},e.driver_id)}))]}))},S=a.a.memo(A),f=(n(65),function(e){return Object(g.jsx)("div",{className:"user-detail","aria-label":"user-detail",children:e.user?Object(g.jsx)(a.a.Fragment,{children:"Granted"===e.user.geoPermission?Object(g.jsxs)(a.a.Fragment,{children:[Object(g.jsxs)("div",{className:"user-detail-header","aria-label":"user-detail-granted",children:[Object(g.jsxs)("span",{className:"user-detail-header-text",children:[" ","Location Access : ",e.user.geoPermission]})," ",Object(g.jsx)("span",{className:"user-detail-header-arrow",children:">"})]}),Object(g.jsxs)("div",{className:"user-detail-granted-content-section",children:[Object(g.jsxs)("div",{className:"user-detail-granted-content",children:["Location :",e.user.latitude?e.user.latitude.toFixed(2):null,",",e.user.longitude?e.user.longitude.toFixed(2):null]}),Object(g.jsxs)("div",{className:"user-detail-granted-content",children:["Nearest HQ: ",e.user.HQLocation.country]})]})]}):Object(g.jsxs)(a.a.Fragment,{children:[Object(g.jsxs)("div",{className:"user-detail-header","aria-label":"user-detail-denied",children:[Object(g.jsxs)("span",{className:"user-detail-header-text",children:["Location Access : ",e.user.geoPermission]}),Object(g.jsx)("span",{className:"user-detail-header-arrow",children:">"})]}),Object(g.jsx)("div",{className:"user-detail-denied-content-section",children:Object(g.jsxs)("div",{className:"user-detail-denied-content",children:["Allow Location Permission of your browser to localhost:3000",Object(g.jsx)("br",{}),"and get the best experience :)"]})})]})}):Object(g.jsx)(a.a.Fragment,{children:Object(g.jsxs)("div",{className:"user-detail-header","aria-label":"user-detail-loading",children:[Object(g.jsx)("span",{className:"user-detail-header-text",children:" Getting Permission"})," "]})})})}),m=n(17),N=n(48),R=n.n(N),x=(n(67),function(e){var t=Object(r.useState)([{country:b,latitude:0,longitude:0}]),n=Object(E.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)({country:b,latitude:0,longitude:0}),o=Object(E.a)(i,2),s=o[0],u=o[1];Object(r.useEffect)((function(){var t=e.locations?e.locations:[],n=R.a.uniqBy([].concat(Object(m.a)(t),Object(m.a)(a)),"country");c(n)}),[e.locations]);return Object(g.jsxs)("div",{className:"hq-selector","aria-label":"hq-selector",children:[Object(g.jsxs)("div",{className:"hq-selector-header",children:[Object(g.jsx)("span",{className:"hq-selector-header-text",children:s.country})," ",Object(g.jsx)("span",{className:"hq-selector-header-arrow",children:">"})]}),Object(g.jsx)("div",{className:"hq-selector-selections",children:a.map((function(t){return Object(g.jsx)("div",{"aria-label":"hq-selector-selection-".concat(t.country.toLowerCase()),"data-test-id":"",className:s.country===t.country?"selected hq-selector-selection":"hq-selector-selection",onClick:function(){return function(t){return u(t),t.country===b?e.returnToNearest?e.returnToNearest():null:e.onClick({HQLocation:t})}(t)},children:t.country},t.country)}))})]})}),P=(n(68),function(e){var t=Object(r.useState)(e.count?e.count:"0"),n=Object(E.a)(t,2),a=n[0],c=n[1];return Object(g.jsxs)("div",{className:"driver-count-slider-container",children:[Object(g.jsx)("p",{className:"driver-count-slider-header","aria-label":"driver-count-title",children:"Taxi Count"}),Object(g.jsx)("input",{className:"driver-count-slider-input","aria-label":"driver-count-slider",type:"range",min:e.minValue,max:e.maxValue,value:a,onChange:function(t){return function(t){e.onChange(t),c(t.target.value)}(t)}}),Object(g.jsx)("p",{className:"driver-count-slider-count","aria-label":"driver-count-text",children:a})]})});function L(e,t){return{REQUESTED:"".concat(e,"/").concat(t,"/REQUESTED"),SUCCESS:"".concat(e,"/").concat(t,"/SUCCESS"),FAILED:"".concat(e,"/").concat(t,"/FAILED")}}var C={MODEL:"users",UPDATE_USER_LOCATION:"UPDATE_USER_LOCATION",UPDATE_USER_DRIVER_COUNT:"UPDATE_USER_DRIVER_COUNT",GET_NEAREST_HQ_LOCATION:L("users","GET_NEAREST_HQ_LOCATION"),UPDATE_USER_HQ_LOCATION:"UPDATE_USER_HQ_LOCATION"};var y={MODEL:"drivers",GET_NEAREST_DRIVERS:L("drivers","GET_NEAREST_DRIVERS")};function D(e){var t=e.coords;return{longitude:t.longitude,latitude:t.latitude,geoPermission:"Granted"}}function I(e){return alert("Hey There !\nPlease Allow Location to work :) \nGo To Settings on the Top Right corner \nPrivacy and Security\nSite Settings > localhost:3000 \nLocation > Allow\n"),{longitude:null,latitude:null,geoPermission:"Denied"}}function U(e){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.geolocation.getCurrentPosition((function(t){console.log("Success");var n=D(t),r=n.longitude,a=n.latitude,c=n.geoPermission;e({longitude:r,latitude:a,geoPermission:c})}),(function(t){console.log("Failed");var n=I(),r=n.longitude,a=n.latitude,c=n.geoPermission;e({longitude:r,latitude:a,geoPermission:c})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H={updateUserLocation:function(e){return{type:C.UPDATE_USER_LOCATION,payload:e}},updateUserDriverCount:function(e){return{type:C.UPDATE_USER_DRIVER_COUNT,payload:e}},getNearestHQLocation:function(e){return{type:C.GET_NEAREST_HQ_LOCATION.REQUESTED,payload:e}},getNearestDrivers:function(){return{type:y.GET_NEAREST_DRIVERS.REQUESTED,payload:{}}},updateUserHQLocation:function(e){return{type:C.UPDATE_USER_HQ_LOCATION,payload:e}}},Q=Object(d.b)((function(e,t){return{user:e.user,driver:e.driver}}),H)((function(e){var t;Object(r.useEffect)((function(){clearInterval();var t=setInterval((function(){e.getNearestDrivers&&e.getNearestDrivers()}),5e3);return function(){return clearInterval(t)}}),[e.getNearestDrivers]);var n=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(navigator);case 2:return t=e.sent,n=t.longitude,r=t.latitude,a=t.geoPermission,console.log({longitude:n,latitude:r,geoPermission:a}),e.abrupt("return",{longitude:n,latitude:r,geoPermission:a});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){n().then((function(t){var n=t.longitude,r=t.latitude,a=t.geoPermission;e.updateUserLocation&&e.updateUserLocation({longitude:n,latitude:r,geoPermission:a}),e.getNearestHQLocation&&e.getNearestHQLocation({longitude:n,latitude:r})}))}),[navigator.permissions]),Object(g.jsxs)("div",{className:"App",children:[Object(g.jsxs)("div",{className:"action-container",children:[Object(g.jsxs)("div",{className:"left-action-container",children:[Object(g.jsx)(x,{locations:h,returnToNearest:function(){return e.getNearestHQLocation&&e.user?e.getNearestHQLocation(Object(o.a)({},e.user)):null},onClick:function(t){return e.updateUserHQLocation?e.updateUserHQLocation(t):null}}),Object(g.jsx)(P,{maxValue:10,minValue:1,count:null===(t=e.user)||void 0===t?void 0:t.driverCount,onChange:function(t){return e.updateUserDriverCount?e.updateUserDriverCount({driverCount:t.target.value}):null}})]}),Object(g.jsx)("div",{className:"right-action-container",children:Object(g.jsx)(f,{user:null===e||void 0===e?void 0:e.user})})]}),Object(g.jsx)(S,{user:e.user,driver:e.driver,getNearestDrivers:e.getNearestDrivers})]})})),G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,101)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))},k=n(18),M=n(51),F={status:null,longitude:null,latitude:null,driverCount:"5",geoPermission:null,HQLocation:{country:null,longitude:null,latitude:null}};var V=function(e){return e.user},q={status:null,count:0,drivers:[],error:"",pickup_eta:null};var K=Object(k.b)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C.UPDATE_USER_LOCATION:return Object(o.a)(Object(o.a)({status:"updated"},e),t.payload);case C.UPDATE_USER_DRIVER_COUNT:return Object(o.a)(Object(o.a)({},e),{},{status:"updated"},t.payload);case C.UPDATE_USER_HQ_LOCATION:return Object(o.a)(Object(o.a)({status:"updated"},e),t.payload);case C.GET_NEAREST_HQ_LOCATION.REQUESTED:return Object(o.a)({},e);case C.GET_NEAREST_HQ_LOCATION.SUCCESS:return Object(o.a)(Object(o.a)({},e),t.payload);case C.GET_NEAREST_HQ_LOCATION.FAILED:return Object(o.a)(Object(o.a)({},e),{},{HQLocation:{country:"Singapore",longitude:103.8522982,latitude:1.285194}});default:return e}},driver:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.GET_NEAREST_DRIVERS.REQUESTED:return Object(o.a)(Object(o.a)({},e),{},{status:"requesting"});case y.GET_NEAREST_DRIVERS.SUCCESS:return Object(o.a)(Object(o.a)({},e),{},{status:"success"},t.payload);case y.GET_NEAREST_DRIVERS.FAILED:return Object(o.a)(Object(o.a)({},e),{},{status:"failed"});default:return e}}}),z=n(9),W=n(49),Y=n.n(W),B=n(50),Z=n.n(B);function J(e){var t=e.model,n=e.route,r=e.query,a=function(e){var t=e.method,n=e.data,r=e.contentType,a=(e.token,{});switch(a.Authorization="Basic ".concat(btoa("public:".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_KEY:"SPLYT_DRIVERS",REACT_APP_API_URL:"http://localhost:8000",REACT_APP_MAP_GL_STYLE:"mapbox://styles/hanjianlee/cksaik6c72bn617pjm3hbo37w",REACT_APP_MAP_GL_TOKEN:"pk.eyJ1IjoiaGFuamlhbmxlZSIsImEiOiJja3M3a2pzajEzaWd5MnBvNzRsZmxkY2tjIn0.tjizL4MBEZPSWqp6FQ-AGA"}).API_KEY))),r){case j:return{method:t,headers:Object(o.a)(Object(o.a)({"content-type":j},a),{},{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,PATCH,OPTIONS"}),data:n};default:return{method:t,headers:Object(o.a)(Object(o.a)({"content-type":"applciation/json"},a),{},{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,PATCH,OPTIONS"}),data:n}}}({method:"GET",contentType:e.contentType}),c=function(e){var t=e.host,n=e.prefix,r=e.model,a=e.route,c=e.query,i="".concat(t);return n&&(i+="/".concat(n)),i+="/".concat(r),a&&(i+="/".concat(a)),c&&(i+="?".concat(Z.a.stringify(c))),i}({host:v,prefix:"api",route:n,model:t,query:r});return function(e){var t=e.url,n=e.method,r=e.data;return Y.a.request({url:t,method:n,data:r,crossDomain:!0}).then((function(e){return e})).catch((function(e){return{error:e}}))}(Object(o.a)({url:c},a))}var X=u.a.mark(ee),$=u.a.mark(te);function ee(e){var t,n,r,a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(z.e)(V);case 3:if(t=e.sent,n=t.HQLocation,r=t.driverCount,a=n.longitude,c=n.latitude,!(Number(r)<1)&&a&&c){e.next=8;break}return e.abrupt("return",Object(z.d)({type:y.GET_NEAREST_DRIVERS.FAILED,payload:{}}));case 8:return e.next=10,Object(z.b)(J,{model:y.MODEL,route:"getDrivers",query:{count:r,longitude:a,latitude:c}});case 10:if(!((i=e.sent).status>=400)){e.next=13;break}return e.abrupt("return",Object(z.d)({type:y.GET_NEAREST_DRIVERS.FAILED,payload:{}}));case 13:return e.next=15,Object(z.d)({type:y.GET_NEAREST_DRIVERS.SUCCESS,payload:Object(o.a)(Object(o.a)({},i.data),{},{count:i.data.drivers.length})});case 15:e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(0),e.next=21,Object(z.d)({type:y.GET_NEAREST_DRIVERS.FAILED,payload:{error:e.t0}});case 21:case"end":return e.stop()}}),X,null,[[0,17]])}function te(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(z.a)([Object(z.f)(y.GET_NEAREST_DRIVERS.REQUESTED,ee)]);case 2:case"end":return e.stop()}}),$)}var ne=te;function re(e){var t=e.latitude1,n=e.latitude2,r=e.longitude1,a=e.longitude2,c=ae(n-t),i=ae(a-r),o=Math.sin(c/2)*Math.sin(c/2)+Math.cos(ae(t))*Math.cos(ae(n))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function ae(e){return e*(Math.PI/180)}var ce=u.a.mark(oe),ie=u.a.mark(se);function oe(e){var t,n,r,a,c,i;return u.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,t=e.payload,n=t.longitude,r=t.latitude,n){o.next=5;break}return o.next=5,Object(z.d)({type:C.GET_NEAREST_HQ_LOCATION.FAILED,payload:{error:"Invalid Longitude "}});case 5:if(r){o.next=8;break}return o.next=8,Object(z.d)({type:C.GET_NEAREST_HQ_LOCATION.FAILED,payload:{error:"Invalid Latitude"}});case 8:return a=0,c=0,i={country:"",longitude:0,latitude:0},h.forEach((function(e,t){c=re({latitude1:r,longitude1:n,latitude2:e.latitude,longitude2:e.longitude}),(0===t||a>c)&&(a=c,i=e)})),o.next=14,Object(z.d)({type:C.GET_NEAREST_HQ_LOCATION.SUCCESS,payload:{HQLocation:i}});case 14:o.next=20;break;case 16:return o.prev=16,o.t0=o.catch(0),o.next=20,Object(z.d)({type:C.GET_NEAREST_HQ_LOCATION.FAILED,payload:{error:o.t0}});case 20:case"end":return o.stop()}}),ce,null,[[0,16]])}function se(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(z.a)([Object(z.f)(C.GET_NEAREST_HQ_LOCATION.REQUESTED,oe)]);case 2:case"end":return e.stop()}}),ie)}var ue=se,le=u.a.mark(de);function de(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(z.a)([Object(z.c)(ne)]);case 2:return e.next=4,Object(z.a)([Object(z.c)(ue)]);case 4:case"end":return e.stop()}}),le)}var Ee=Object(M.a)(),Oe=Object(k.d)(K,Object(k.a)(Ee));Ee.run(de);var je=Oe;i.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(d.a,{store:je,children:Object(g.jsx)(Q,{})})}),document.getElementById("root")),G()},56:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},65:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){}},[[100,1,2]]]);
//# sourceMappingURL=main.7f6d983f.chunk.js.map